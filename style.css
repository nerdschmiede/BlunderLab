/* =========================================================
   BlunderLab – Style (mobile first)
   - Layout (Board + Controls + Inputs)
   - Chessground: Lichess-like board colors
   - Promotion highlight via highlight.custom -> square.promo
   - PGN clickable line
   ========================================================= */

*, *::before, *::after { box-sizing: border-box; }


/* ---------- Theme / Variables ---------- */
:root {
    --pad: 12px;

    /* Board max size relative to viewport */
    --board-max: 92vmin;

    /* Lichess board colors */
    --lichess-light: #f0d9b5;
    --lichess-dark:  #b58863;

    /* Promotion square fill (semi transparent grey) */
    --promo-fill: lightgray;

    /* Promo dimmer (board overlay) */
    --promo-dim: rgba(0, 0, 0, 0.45);

    /* UI theme (dark) */
    --ui-bg: #0f1115;
    --ui-panel: #151923;
    --ui-text: #e7eaf0;
    --ui-muted: #a7afbf;
    --ui-border: rgba(255,255,255,.10);
    --ui-shadow: 0 10px 30px rgba(0,0,0,.35);
    --ui-focus: #6aa6ff;

    --coord-size: clamp(10px, calc(var(--board-max) / 30), 16px);

}

/* Landscape tweak */
@media (orientation: landscape) {
    :root { --board-max: 100vmin; }
}
@media (orientation: portrait) {
    body { margin: 0; }

    /* common wrappers that often add side padding */
    #app, main, .app, .container, .page, .layout {
        padding-left: 0 !important;
        padding-right: 0 !important;
        max-width: none !important;
        width: 100%;
    }

    .board {
        width: 100%;
        max-width: none;
        margin-left: 0;
        margin-right: 0;
    }
}



/* Global box sizing */
*, *::before, *::after { box-sizing: border-box; }

/* Prevent 1–2px horizontal overflow on some mobile browsers */
html, body {
    width: 100%;
    overflow-x: hidden;
}

/* ---------- Base ---------- */
body {
    margin: 0;
    padding: var(--pad);
    background: var(--ui-bg);
    color: var(--ui-text);
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
}

/* ---------- Page Layout ---------- */
.page {
    display: grid;
    justify-items: center;
}

.title {
    margin: 4px 0 2px;
    font-size: 22px;
}

/* ---------- PGN line (single line, scrolls left) ---------- */

.board-stack {
    width: min(92vw, 520px);
    margin: 0 auto;
    overflow: hidden;   /* fallback clipping */
    min-width: 0;       /* wichtig bei flex parents */
}

#pgn-line {
    width: 100%;
    min-height: 24px;
    line-height: 24px;

    overflow: hidden;
    white-space: nowrap;

    /* LTR normal */
    direction: ltr;

    margin: 0 0 1px 0;

    /* optional: leichtes Padding, verhindert "kleben" am Rand */
    padding: 0 2px;

    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
    font-size: 14px;
}




/* ---------- Board + Controls ---------- */
.board {
    width: min(100%, var(--board-max));
    aspect-ratio: 1 / 1;
    margin: 0;
    padding: 0;
    line-height: 0;
}

.controls {
    width: min(100%, var(--board-max));
    margin: 0 auto;
    display: flex;
    gap: 10px;
    align-items: center;
    justify-content: center; /* center horizontally */
    flex-wrap: nowrap;
    padding: 6px 0;
}

.controls .importexport{
    width: min(100%, var(--board-max));
    display: flex;
    justify-content: center;
    gap: 12px;
    flex-wrap: wrap;
    margin: 0 auto;

}
/* Buttons */
.iconbtn {
    width: 52px;
    height: 52px;
    border-radius: 14px;
    background: var(--ui-panel);
    color: var(--ui-text);
    border: 1px solid var(--ui-border);
    font-size: 22px;
    line-height: 1;
    cursor: pointer;
    touch-action: manipulation;
}

.iconbtn:disabled {
    opacity: 0.45;
    cursor: not-allowed;
}
.icon-btn.text-btn {
    padding: 0 0.9rem;
    height: 40px;
    font-size: 0.9rem;
    border-radius: 12px;
    background: var(--ui-panel);
    color: var(--ui-text);
    border: 1px solid var(--ui-border);
}


/* ---------- FEN Input ---------- */
.input-box {
    display: block;
    width: min(100%, var(--board-max)); /* avoid 100vw */
    padding: 10px 12px;
    margin: 0 auto;
    border-radius: 12px;
    background: var(--ui-panel);
    color: var(--ui-text);
    border: 1px solid var(--ui-border);
    font-size: 13px;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
}

.input-box.invalid {
    border-color: #b00020;
    background: #fff5f6;
}

/* ---------- Chessground: Board background (Lichess-like checkered) ---------- */
cg-board {
    background-color: var(--lichess-light) !important;
    background-image: url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8' shape-rendering='crispEdges'>\
<defs>\
<pattern id='p' width='2' height='2' patternUnits='userSpaceOnUse'>\
<rect width='1' height='1' fill='%23f0d9b5'/>\
<rect x='1' width='1' height='1' fill='%23b58863'/>\
<rect y='1' width='1' height='1' fill='%23b58863'/>\
<rect x='1' y='1' width='1' height='1' fill='%23f0d9b5'/>\
</pattern>\
</defs>\
<rect width='8' height='8' fill='url(%23p)'/>\
</svg>") !important;
}

/* ---------- Chessground: Coordinates (ranks on the right) ---------- */
.cg-wrap coords{
    font-size: var(--coord-size);
    line-height: 1;
}

.cg-wrap coords.ranks.left { display: none !important; }

.cg-wrap coords.ranks {
    left: auto !important;
    right: -4px !important;   /* tweak; set to 0 if you want strict alignment */
    top: 0 !important;    /* align with top of board */

}

.cg-wrap coords.files {
    bottom: -2px;
    left: 0;
    flex-flow: row;
    width: 100%;
    height: 16px;
    text-transform: uppercase;
    text-align: center;
}

/* =========================================================
   Promotion focus
   - Uses a real DOM element (.promo-dimmer) inside .cg-wrap
   - Promo squares get fill + pulsing ring (square.promo)
   ========================================================= */

.cg-wrap { position: relative; }

/* Dimmer layer (must exist in DOM) */
.cg-wrap .promo-dimmer {
    position: absolute;
    inset: 0;
    background: var(--promo-dim);
    opacity: 0;
    pointer-events: none;
    transition: opacity 120ms ease;
    z-index: 5;
}

.cg-wrap.promo-active .promo-dimmer { opacity: 1; }

/* Optional: slightly dull the board colors during promotion */
.cg-wrap.promo-active cg-board {
    filter: grayscale(0.35) brightness(0.85);
}

/* Promo squares: fill + pulse ring */
.cg-wrap square.promo {
    background: var(--promo-fill);
    box-shadow:
            inset 0 0 0 3px rgba(255, 255, 255, 0.65),
            inset 0 0 0 6px rgba(0, 0, 0, 0.28);
    animation: promoPulse 1.2s ease-in-out infinite;
}

@keyframes promoPulse {
    0% {
        box-shadow:
                inset 0 0 0 3px rgba(255, 255, 255, 0.55),
                inset 0 0 0 6px rgba(0, 0, 0, 0.22);
    }
    50% {
        box-shadow:
                inset 0 0 0 3px rgba(255, 255, 255, 0.90),
                inset 0 0 0 6px rgba(0, 0, 0, 0.38);
    }
    100% {
        box-shadow:
                inset 0 0 0 3px rgba(255, 255, 255, 0.55),
                inset 0 0 0 6px rgba(0, 0, 0, 0.22);
    }
}

@media (prefers-reduced-motion: reduce) {
    .cg-wrap square.promo { animation: none; }
}

/* ---------- Overlay (Study Picker) ---------- */
.overlay.hidden { display: none; }

.overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.55);
    display: grid;
    place-items: end center;
    padding: var(--pad);
    z-index: 50;
}

.sheet {
    width: min(100%, var(--board-max));
    background: var(--ui-panel);                 /* <- war #fff */
    color: var(--ui-text);                       /* <- neu */
    border-radius: 16px;
    border: 1px solid var(--ui-border);          /* <- war rgba(0,0,0,0.12) */
    padding: 12px;
    box-shadow: var(--ui-shadow);                /* <- war 0 12px... */
}

.sheet-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
}

.sheet-title {
    font-size: 16px;
    font-weight: 600;
}

.sheet-actions {
    display: flex;
    justify-content: flex-end;
    margin: 10px 0;
}

.study-list {
    display: grid;
    gap: 8px;
}

.study-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
    padding: 10px 12px;
    border-radius: 12px;
    border: 1px solid var(--ui-border);
    background: rgba(255,255,255,.04);
    color: var(--ui-text);
}

.study-meta {
    display: grid;
    gap: 2px;
}

.study-name { font-weight: 600; }
.study-sub { font-size: 12px; color: var(--ui-muted); opacity: 1; }

.study-item .iconbtn { width: 44px; height: 44px; border-radius: 12px; }

.new-study { display: grid; gap: 10px; margin-bottom: 10px; }
.new-study.hidden { display: none; }

.segmented {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
}

.seg-btn {
    height: 44px;
    border-radius: 12px;
    background: var(--ui-panel);
    color: var(--ui-text);
    border: 1px solid var(--ui-border);
    font: inherit;
}

.seg-btn.active {
    background: rgba(255,255,255,.10);
    border-color: rgba(255,255,255,.18);
    color: var(--ui-text);
    font-weight: 600;
}

.row {
    display: flex;
    gap: 8px;
    justify-content: flex-end;
    flex-wrap: wrap;
}

.row .btn {
    flex: 1 1 140px; /* beide Buttons werden gleich breit, brechen bei Bedarf um */
}


.btn {
    height: 44px;
    padding: 0 14px;
    border-radius: 12px;
    background: var(--ui-panel);
    color: var(--ui-text);
    border: 1px solid var(--ui-border);
    font: inherit;
    white-space: nowrap;
}

.btn.primary {
    background: rgba(255,255,255,.10);
    border-color: rgba(255,255,255,.18);
    color: var(--ui-text);
    font-weight: 600;
}

.study-rename.input-box {
    padding: 8px 10px;
    border-radius: 10px;
}

/* Ensure piece transforms animate smoothly (helps user-drag and programmatic moves) */
/* Exclude the ghost element, pieces that are currently animating, or being dragged */
.cg-wrap piece:not(.ghost):not(.anim):not(.dragging), .cg-wrap .piece:not(.ghost):not(.anim):not(.dragging) {
    transition: transform 260ms cubic-bezier(0.2, 0.8, 0.2, 1);
    will-change: transform;
}

.cg-wrap .piece.anim {
    /* class Chessground uses during animation: avoid CSS transitions here to let CG control animation */
    transition: none !important;
}

.cg-wrap.cg-no-trans piece, .cg-wrap.cg-no-trans .piece, .cg-wrap.cg-no-trans .ghost {
    transition: none !important;
}

/* Segmented mode toggle (two equal buttons) */
.segmented-toggle {
    display: inline-flex;
    gap: 6px; /* smaller gap so buttons appear closer together */
    align-items: center;
    justify-content: center;
    flex-wrap: wrap;
}

.segmented-toggle .iconbtn {
    flex: 0 0 auto;
    min-width: 96px; /* slightly narrower so the row fits better */
    height: 44px;
    border-radius: 12px;
    padding: 0 12px;
    font-size: 14px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    background: transparent;
    color: var(--ui-muted);
    border: 1px solid transparent;
}

.segmented-toggle .iconbtn.active {
    background: rgba(255,255,255,.08);
    color: var(--ui-text);
    border-color: rgba(255,255,255,.12);
}

.segmented-toggle .iconbtn:focus {
    outline: 2px solid rgba(0,0,0,0.08);
    outline-offset: 2px;
}

/* Mode row sits directly under the board and centers the toggle */
.mode-row {
    width: min(100%, var(--board-max));
    margin: 0 auto;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 2px 0 2px 0; /* minimal vertical padding so it hugs the board */
}

/* Make segmented-toggle wrap on tiny screens while keeping centered alignment */
.segmented-toggle {
    display: inline-flex;
    gap: 6px;
    align-items: center;
    justify-content: center;
    flex-wrap: wrap;
}

.segmented-toggle .iconbtn {
    flex: 0 0 auto;
    min-width: 96px;
}

@media (max-width: 420px) {
    .segment-toggle .iconbtn, .segmented-toggle .iconbtn { min-width: 84px; }
}

